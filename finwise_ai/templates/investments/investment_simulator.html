{% extends 'base.html' %}
{% load static %}

{% block title %}Investment Simulator{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="h3">
                    <i class="fas fa-chart-line me-2"></i>
                    Investment Simulator
                </h1>
                <a href="{% url 'investments:investments_home' %}" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-2"></i>Back to Investments
                </a>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-calculator me-2"></i>
                        Investment Calculator
                    </h5>
                </div>
                <div class="card-body">
                    <form method="post" class="needs-validation" novalidate>
                        {% csrf_token %}
                        
                        <div class="mb-3">
                            <label for="initial_amount" class="form-label">Initial Investment Amount</label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" id="initial_amount" name="initial_amount" 
                                       step="0.01" min="0" value="{{ request.POST.initial_amount|default:'' }}" required>
                            </div>
                            <div class="invalid-feedback">
                                Please provide a valid initial investment amount.
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="monthly_contribution" class="form-label">Monthly Contribution</label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" id="monthly_contribution" name="monthly_contribution" 
                                       step="0.01" min="0" value="{{ request.POST.monthly_contribution|default:'' }}">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="annual_return" class="form-label">Expected Annual Return (%)</label>
                            <input type="number" class="form-control" id="annual_return" name="annual_return" 
                                   step="0.01" min="0" max="100" value="{{ request.POST.annual_return|default:'7' }}" required>
                            <div class="form-text">Historical average stock market return is around 7-10%</div>
                        </div>

                        <div class="mb-3">
                            <label for="investment_years" class="form-label">Investment Period (Years)</label>
                            <input type="number" class="form-control" id="investment_years" name="investment_years" 
                                   min="1" max="50" value="{{ request.POST.investment_years|default:'10' }}" required>
                        </div>

                        <div class="mb-3">
                            <label for="compound_frequency" class="form-label">Compounding Frequency</label>
                            <select class="form-select" id="compound_frequency" name="compound_frequency" required>
                                <option value="1" {% if request.POST.compound_frequency == '1' %}selected{% endif %}>Annually</option>
                                <option value="2" {% if request.POST.compound_frequency == '2' %}selected{% endif %}>Semi-annually</option>
                                <option value="4" {% if request.POST.compound_frequency == '4' %}selected{% endif %}>Quarterly</option>
                                <option value="12" {% if request.POST.compound_frequency == '12' or not request.POST.compound_frequency %}selected{% endif %}>Monthly</option>
                            </select>
                        </div>

                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-calculator me-2"></i>Calculate Investment
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-lg-6 mb-4">
            {% if results %}
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-chart-pie me-2"></i>
                        Investment Results
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="bg-light p-3 rounded">
                                <h6 class="text-muted mb-1">Final Value</h6>
                                <h3 class="text-success mb-0">${{ results.final_value|floatformat:2 }}</h3>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="bg-light p-3 rounded">
                                <h6 class="text-muted mb-1">Total Contributions</h6>
                                <h3 class="text-primary mb-0">${{ results.total_contributions|floatformat:2 }}</h3>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="bg-light p-3 rounded">
                                <h6 class="text-muted mb-1">Total Interest Earned</h6>
                                <h3 class="text-info mb-0">${{ results.total_interest|floatformat:2 }}</h3>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="bg-light p-3 rounded">
                                <h6 class="text-muted mb-1">Total Return</h6>
                                <h3 class="text-warning mb-0">{{ results.total_return|floatformat:1 }}%</h3>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4">
                        <h6>Investment Breakdown</h6>
                        <div class="progress mb-2" style="height: 20px;">
                            <div class="progress-bar bg-primary" role="progressbar" 
                                 style="width: {{ results.contribution_percentage }}%" 
                                 aria-valuenow="{{ results.contribution_percentage }}" 
                                 aria-valuemin="0" aria-valuemax="100">
                                Contributions ({{ results.contribution_percentage|floatformat:1 }}%)
                            </div>
                            <div class="progress-bar bg-success" role="progressbar" 
                                 style="width: {{ results.interest_percentage }}%" 
                                 aria-valuenow="{{ results.interest_percentage }}" 
                                 aria-valuemin="0" aria-valuemax="100">
                                Interest ({{ results.interest_percentage|floatformat:1 }}%)
                            </div>
                        </div>
                    </div>

                    <div class="mt-4">
                        <h6>Investment Summary</h6>
                        <ul class="list-unstyled">
                            <li><strong>Initial Investment:</strong> ${{ results.initial_amount|floatformat:2 }}</li>
                            <li><strong>Monthly Contributions:</strong> ${{ results.monthly_contribution|floatformat:2 }}</li>
                            <li><strong>Annual Return Rate:</strong> {{ results.annual_return }}%</li>
                            <li><strong>Investment Period:</strong> {{ results.investment_years }} years</li>
                            <li><strong>Compounding:</strong> {{ results.compound_frequency_text }}</li>
                        </ul>
                    </div>

                    <div class="mt-3">
                        <a href="{% url 'investments:investment_create' %}" class="btn btn-success me-2">
                            <i class="fas fa-plus me-2"></i>Start This Investment
                        </a>
                        <button class="btn btn-outline-primary" onclick="window.print()">
                            <i class="fas fa-print me-2"></i>Print Results
                        </button>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="card">
                <div class="card-body text-center py-5">
                    <i class="fas fa-chart-line fa-4x text-muted mb-3"></i>
                    <h5 class="text-muted">Enter investment details to see projected returns</h5>
                    <p class="text-muted">Use the calculator on the left to simulate your investment growth over time.</p>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    {% if results %}
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-chart-area me-2"></i>
                        Investment Growth Over Time
                    </h5>
                </div>
                <div class="card-body">
                    <canvas id="investmentChart" height="400"></canvas>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
{% if results %}
<script>
// Investment growth chart
const ctx = document.getElementById('investmentChart').getContext('2d');
const chartData = {{ results.chart_data|safe }};

new Chart(ctx, {
    type: 'line',
    data: {
        labels: chartData.labels,
        datasets: [{
            label: 'Total Value',
            data: chartData.total_values,
            borderColor: '#28a745',
            backgroundColor: 'rgba(40, 167, 69, 0.1)',
            fill: true,
            tension: 0.4
        }, {
            label: 'Total Contributions',
            data: chartData.contributions,
            borderColor: '#007bff',
            backgroundColor: 'rgba(0, 123, 255, 0.1)',
            fill: true,
            tension: 0.4
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    callback: function(value) {
                        return '$' + value.toLocaleString();
                    }
                }
            }
        },
        plugins: {
            tooltip: {
                callbacks: {
                    label: function(context) {
                        return context.dataset.label + ': $' + context.parsed.y.toLocaleString();
                    }
                }
            }
        }
    }
});
</script>
{% endif %}
{% endblock %} 